function getTalentsWithJavascript(a,c){const d=new Date(a[0]),f=a.slice(1,8),g=f.map(A=>A.filter(B=>B)),h=f.map(A=>A.length),j=g.map(A=>A.length),n=j.reduce((A,B)=>A+B);let o=[],q=[];const r=[{},{},{},{},{},{},{}],s=[0,1,2,3,4,5,6].map(A=>g[A].map((B,C)=>{return r[A][B]={index:C,builds:[]},[B,0,0,0,0,0,0]}));let u=0;for(let A=8;A<a.length;A++){const B=[0,0,0,0,0,0,0,0,0,0,0];let[C,D,E]=a[A],F=!0;for(let G=6;0<=G;G--){let H=h[G],I=C%H;C=Math.floor(C/H),null===f[G][I]&&(F=!1),B[G]=f[G][I]}B[7]=E,B[8]=D,F?(B.slice(0,7).map((G,H)=>{r[H][G].builds.push(u);let I=r[H][G].index;for(let J=1;3>J;J++)s[H][I][2*J+1]+=E,s[H][I][2*J+2]+=D}),B[9]=1e3*E,B[10]=1e3*D,u+=1,q.push(B)):B[0]&&o.push(B.slice(0,9))}const v=o.length,w=[],z=[];for(let B,A=0;A<v;A++)if(B=o[A][0],B){let{index:M,builds:N}=r[0][o[A][0]];for(let R,Q=0;7>Q&&(R=o[A][Q],!!R);Q++){0<Q&&(M=r[Q][R].index),s[Q][M][3]+=o[A][7],s[Q][M][4]+=o[A][8];let S=N.length,T=[];for(let V,U=0;U<S;U++)V=N[U],q[V][Q]===R&&T.push(V);N=T}let O=0,P=N.length;for(let Q=0;Q<P;Q++)O+=q[N[Q]][8];w.push(N),z.push(O)}for(let A=0;A<v;A++){let B=z[A],[C,D]=o[A].slice(7,9),E=w[A],F=E.length;for(let G=0;G<F;G++){let H=E[G],I=q[H][8]/B;q[H][9]+=1e3*C*I,q[H][10]+=1e3*D*I}}for(let A=0;A<u;A++)for(let C,B=0;7>B;B++)C=r[B][q[A][B]].index,s[B][C][1]+=q[A][9],s[B][C][2]+=q[A][10];return o=new Int32Array([].concat(...o)),q=new Int32Array([].concat(...q)),{nTalents:n,nFull:u,nPartial:v,talentCounts:j,talents:s,fullBuilds:q,partialBuilds:o,dataTime:d,hero:c}}self.addEventListener('message',function(a){let{response:c,hero:d}=a.data;if(c=JSON.parse(c),20===d)for(let g=1;8>g;g++){const h=c[g].indexOf(0);-1!==h&&(c[g][h]=1998)}const f=getTalentsWithJavascript(c,d);self.postMessage(f)});
